---
- name: create .ssh directory
  file: path=~/.ssh state=directory

- name: copy public key
# Note that this means you can only have one authorized key.
  copy: src=id_rsa.pub dest=~/.ssh/authorized_keys2

- name: turn off password authentication
  become: true
  lineinfile:
    dest: /etc/ssh/sshd_config
    regexp: "^#PasswordAuthentication yes$"
    line: PasswordAuthentication no
    backrefs: yes
    # if this isn't set, line will be added even if no match of regexp was found
  notify: restart sshd